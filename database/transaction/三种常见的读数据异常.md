## 三种常见的读数据异常

> 注意：
>
> 这三种异常是针对某个事务的读操作而言

### 脏读

| 时间 | T1主事务     | T2                   |
| ---- | :----------- | -------------------- |
| t0   |              | W(row)-Update/Insert |
| t1   | ***R(row)*** |                      |
| t2   |              | Abort                |
| t3   |              |                      |

> 说明：
>
> - W(row)-Update/Insert，表示写row对象，后面的Update/Insert表示写操作的DML语句中的UPDATE/INSERT语句产生的写数据对象row的操作。
>
> - R(row)，表示读row对象。
>
> - ***R(row)***，斜体加粗表示对应时刻，如果发生对应的操作，将引发异常操作。

强调的是**主事务读取了一个不存在（因回滚而不存在）的数据**。

### 不可重复读

| 时间 | T1主事务     | T2                   |
| ---- | ------------ | -------------------- |
| t0   | R(row)       |                      |
| t1   |              | W(row)-Update/Delete |
| t2   |              | Commit               |
| t3   | ***R(row)*** |                      |

强调的是**主事务无法在不同时刻读取指定行的值保持一致**，该行数据可能被删除或者更新。

在实现上，需要“锁住(考虑)”已经读过的数据

### 幻读

| 时间 | T1主事务                   | T2                                   |
| ---- | -------------------------- | ------------------------------------ |
| t0   | R(rows)-WHERE\<condition\> |                                      |
| t1   |                            | W(rows)-Insert/Update=>\<condition\> |
| t2   | R(rows)-WHERE\<condition\> |                                      |
| t3   |                            |                                      |

> 注：
>
> - R(rows)-WHERE\<condition\> ，表示SQL语句读数据带有WHERE子句，条件表达式是“\<condition\>”
> - W(rows)-WHERE\<condition\>，表示更新和插入操作的行满足\<condition\>

幻读强调的是**主事务第二次读取操作读取了第一次读取操作没有读到的rows**，这些rows在第一次读取时是不存在的

数据库为了预防该情况出现时，还需要对“还不存在的数据”进行加锁处理。



